<section class="dashboard dashboard--admin">
  <!-- Loading global al navegar -->
  <mat-progress-bar *ngIf="isGlobalLoading" mode="indeterminate" color="accent"></mat-progress-bar>

  <h1 class="dashboard__title">{{ title }}</h1>

  <div class="dashboard__section dashboard__section--panel dashboard__section--welcome">
    <div class="dashboard__header">
      <p class="dashboard__subtitle">Bienvenido, {{ nombre }} 游녦</p>
      <div class="dashboard__actions dashboard__actions--right">
        <button mat-icon-button class="btn btn--icon btn--warn"
                (click)="sesionService.logout()" matTooltip="Cerrar sesi칩n"
                aria-label="Cerrar sesi칩n">
          <mat-icon>logout</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- 游늶 Propiedades -->
  <div class="dashboard__section dashboard__section--panel">
    <div class="dashboard__section-title">游늶 <span>Propiedades registradas</span></div>

    <div class="dashboard__actions dashboard__actions--right">
      <button mat-flat-button class="btn btn--primary" (click)="abrirFormulario()">
        <mat-icon>add</mat-icon>
        Nueva propiedad
      </button>
    </div>

    <mat-spinner *ngIf="isCargandoPropiedades"></mat-spinner>

    <app-tabla-propiedades
      *ngIf="!isCargandoPropiedades && propiedades.length > 0"
      [propiedades]="propiedades"
      [mostrarAcciones]="true"
      [pageSize]="5"
      [pageSizeOptions]="[5, 10, 20]"
      [emptyMessage]="'No hay propiedades registradas a칰n.'"
      (editar)="editarPropiedad($event)"
      (eliminar)="eliminarPropiedadDesdeTabla($event.id!)">
    </app-tabla-propiedades>

    <div class="mensaje-vacio" *ngIf="!isCargandoPropiedades && propiedades.length === 0">
      No hay propiedades registradas a칰n.
    </div>
  </div>

  <!-- 游논 Usuarios -->
  <div class="dashboard__section dashboard__section--panel">
    <div class="dashboard__section-title">游논 <span>Usuarios registrados</span></div>

    <div class="dashboard__actions dashboard__actions--right">
      <button mat-flat-button class="btn btn--primary" (click)="abrirFormularioUsuario()">
        <mat-icon>person_add</mat-icon>
        Nuevo usuario
      </button>
    </div>

    <ng-template #rolesTemplate let-row>
      {{ row.roles | formatearRoles }}
    </ng-template>

    <mat-spinner *ngIf="isCargandoUsuarios"></mat-spinner>

    <app-dashboard-table
      *ngIf="!isCargandoUsuarios && usuarios.length > 0"
      [dataSource]="dataSourceUsuarios"
      [displayedColumns]="displayedUserColumns"
      [columnDefs]="[
        { key: 'nombre', label: 'Nombre' },
        { key: 'email', label: 'Email' },
        { key: 'roles', label: 'Roles' }
      ]"
      [customTemplates]="{ roles: rolesTemplate }"
      [emptyMessage]="'No hay usuarios registrados a칰n.'"
      [showActions]="true"
      [showDelete]="true"
      (editar)="editarUsuario($event)"
      (eliminar)="eliminarUsuario($event.id!)">
    </app-dashboard-table>

    <div class="mensaje-vacio" *ngIf="!isCargandoUsuarios && usuarios.length === 0">
      No hay usuarios registrados a칰n.
    </div>
  </div>

  <!-- 游늵 Estad칤sticas -->
  <div class="dashboard__section dashboard__section--panel">
    <div class="dashboard__section-title">游늵 <span>Estad칤sticas</span></div>

    <button mat-stroked-button routerLink="/dashboard/admin/estadisticas" class="btn btn--outline">
      <mat-icon>bar_chart</mat-icon>
      Ver estad칤sticas de propiedades
    </button>
  </div>
</section>
